<!DOCTYPE html>
<html>



<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <style>
            
    body {
        margin: 0;
        font-family: Arial, sans-serif;
    }

    .container {
        display: flex;
        flex-direction: column;
    }

    .right-side, .left-side-box {
        width: 100%;
    }


    .data {
        display: flex; 
        order: 2; 
    }

    .left-side {
        flex: 1;
        width: 100%; 
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .checkbox-container {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        justify-content: flex-start;
    }

    .checkbox {
        margin-right: 10px;
    }



    .filters {
        width: 100%; 
        order: 1; 
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        padding: 20px;
        background-color: #f8f8f8;
        margin-bottom: 20px;
    }

    .filter-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .filter-item {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    select {
        width: 100%;
        padding: 8px;
        font-family: 'Helvetica', Arial, sans-serif;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    .filter-checkbox {
        margin-right: 10px;
    }

    .submit-button {
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        text-align: center;
        color: #ffffff;
        background-color: #4caf50;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .calendar-dropdown {
        position: relative;
        display: inline-block;
    }

    .calendar-dropdown select {
        padding: 5px;
    }
    #filters    label{
        text-align: left;
        width:400px;
    }

    .right-side-box {
        flex: 1;
        padding: 10px;
    }

    .left-side-box {
                flex: 1;
                padding: 10px;
                border-right: 1px solid #ccc;
                overflow-y: auto; /* Add scroll if needed */
            }
            .checkbox-container:nth-child(5n) {
        padding-bottom: 30px;
    }
    #leftSide{
            text-align: left;
            align-items: center;
            align-content: center;
            width:"100%";
            justify-content: center;
    }
    .checkbox-container{
        width:50%;
        line-height: 1.5em;
    }

    .centered-item {
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }

    </style>
</head>






<body>
    <div class="container">
        
        <div class="right-side">
            <div class="filters" style="align-content: center; text-align: center;justify-content: center; display: flex; width: 100%; flex-direction: column;">
                <div class="filter-title">Insights As a Service UI</div>
                <div id="filters" style="display:flex; justify-content: center;" >
      
                    
                    
                    <div style="padding:10px">
                        <div class="filter-item">
                    <label for="state-filter">States:</label>
                    <select id="state-filter" >
                        <option value="all">All States</option>
                        <option value="AL">Alabama</option>
                        <option value="AK">Alaska</option>
                        <option value="AZ">Arizona</option>
                        <option value="AR">Arkansas</option>
                        <option value="CA">California</option>
                        <option value="CO">Colorado</option>
                        <option value="CT">Connecticut</option>
                        <option value="DE">Delaware</option>
                        <option value="FL">Florida</option>
                        <option value="GA">Georgia</option>
                        <option value="HI">Hawaii</option>
                        <option value="ID">Idaho</option>
                        <option value="IL">Illinois</option>
                        <option value="IN">Indiana</option>
                        <option value="IA">Iowa</option>
                        <option value="KS">Kansas</option>
                        <option value="KY">Kentucky</option>
                        <option value="LA">Louisiana</option>
                        <option value="ME">Maine</option>
                        <option value="MD">Maryland</option>
                        <option value="MA">Massachusetts</option>
                        <option value="MI">Michigan</option>
                        <option value="MN">Minnesota</option>
                        <option value="MS">Mississippi</option>
                        <option value="MO">Missouri</option>
                        <option value="MT">Montana</option>
                        <option value="NE">Nebraska</option>
                        <option value="NV">Nevada</option>
                        <option value="NH">New Hampshire</option>
                        <option value="NJ">New Jersey</option>
                        <option value="NM">New Mexico</option>
                        <option value="NY">New York</option>
                        <option value="NC">North Carolina</option>
                        <option value="ND">North Dakota</option>
                        <option value="OH">Ohio</option>
                        <option value="OK">Oklahoma</option>
                        <option value="OR">Oregon</option>
                        <option value="PA">Pennsylvania</option>
                        <option value="RI">Rhode Island</option>
                        <option value="SC">South Carolina</option>
                        <option value="SD">South Dakota</option>
                        <option value="TN">Tennessee</option>
                        <option value="TX">Texas</option>
                        <option value="UT">Utah</option>
                        <option value="VT">Vermont</option>
                        <option value="VA">Virginia</option>
                        <option value="WA">Washington</option>
                        <option value="WV">West Virginia</option>
                        <option value="WI">Wisconsin</option>
                        <option value="WY">Wyoming</option>
                    </select>
                    </div>
                        
                </div>
                <div style="padding:10px">
                    <div class="filter-item">
                <label for="clustering-filter"> Column Names:  </label>
                <select id="clustering-filter">
                    <option value="Churn Rate">Churn Rate</option>
                    <option value="Earned Premium">Earned Premium</option>
                    <option value="Cancellations">Cancellations</option>
                    <option value="Incurred Losses">Incurred Losses</option>
                    <option value="Loss Ratio">Loss Ratio</option>
                    <option value="Day 366 Persist.">Day 366 Persist.</option>
                    <option value="Growth Rate">Growth Rate</option>
                    <option value="Inforce">Inforce</option>
                    <option value="Average Premium">Average Premium</option>
                    <option value="Policies Issued">Policies Issued</option>
                    <option value="Premium">Premium Selected</option>
                    <option value="Renewals">Renewals</option>
                    <option value="Unit Count">Unit Count</option>
                    <option value="Remorse (30 days)">Remorse (30 days)</option>
                    <option value="Remorse (60 days)">Remorse (60 days)</option>
                    <option value="Net Adds">Net Adds</option>
                    <option value="Remorse (90 days)">Remorse (90 days)</option>
                    <option value="Reported Frequency">Reported Frequency</option>
                    <option value="Expirations">Expirations</option>
                    <option value="Reinstatements">Reinstatements</option>
                    <option value="YTD Policies Issued">YTD Policies Issued</option>
                    <option value="Persisting Customers">Persisting Customers</option>
                </select>
                </div>



                <div class="filter-item">
                    <div class="centered-item">
                        <label>Month and Year:</label>
                        <div class="calendar-dropdown">
                            <input type="text" id="calendar-input" placeholder="Select Date">
                        </div>
                    </div>
                </div>

                <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
                <script>
                    flatpickr("#calendar-input", {
                        dateFormat: "F Y", // Display format (e.g., "Month Year")
                        minDate: "1950-01-01", // Minimum selectable date
                        maxDate: new Date(), // Maximum selectable date (current date)
                    });
                </script>


            </div>
                </div>
            </div>
                    
                </div>
                <button id="submit-button" class="submit-button">Apply Filter</button>
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    // Get references to the filter elements
                    const stateFilter = document.getElementById("state-filter");
                    //const containerFilter = document.getElementById("container-filter");
                    const clusteringFilter = document.getElementById("clustering-filter");
                    const calendarInput = document.getElementById("calendar-input"); // Updated
                    const submitButton = document.getElementById("submit-button");
            
                    // Add event listener to the submit button
                    submitButton.addEventListener("click", function () {
                        // Collect selected values from filters
                        const selectedState = stateFilter.value;
                        //const selectedContainer = containerFilter.value;
                        const selectedClustering = clusteringFilter.value;
                        const selectedDate = calendarInput.value; // Updated
            
                        // Extract month and year from selected date
                        const [selectedMonth, selectedYear] = selectedDate.split(' ');
            
                        // Object to store filter details
                        const filterDetails = {
                            state: selectedState,
                            clustering: selectedClustering,
                            month: selectedMonth,
                            year: selectedYear
                        };
            
                        // Sending the filter details to the Flask API using fetch
                        fetch("/submit_filters", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(filterDetails)
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log("Response from Flask API:", data);
                            // Handle response
                        })
                        .catch(error => {
                            console.error("Error sending filter details:", error);
                            // Handle error
                        });
                    });
                });
            </script>
            


                        
            <div class="left-side-box">
                <div class="left-side" id="leftSide">
                    <!-- Entries will be populated here -->
                </div>
            </div>

            <style>
                /* Define the style for highlighting */
                .highlighted {
                    background-color: yellow; /* You can customize the highlighting style */
                }
            </style>

            <script>
                // Fetch entries from the Flask API and populate checkboxes
                fetch('/get_entries')
                    .then(response => response.json())
                    .then(entries => {
                        const leftSide = document.getElementById('leftSide');
                        entries.forEach(entry => {
                            const checkboxContainer = document.createElement('div');
                            checkboxContainer.className = 'checkbox-container';
                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.className = 'checkbox';
                            const label = document.createElement('label');
                            label.textContent = entry; // Use the entry string directly
                            checkboxContainer.appendChild(checkbox);
                            checkboxContainer.appendChild(label);
                            leftSide.appendChild(checkboxContainer);
                            
                            // Add event listener to the checkbox
                            checkbox.addEventListener('click', () => {
                                checkboxContainer.classList.toggle('highlighted');
                                
                                // Store selected entries in local storage
                                const selectedQueries = Array.from(document.querySelectorAll('.checkbox:checked'))
                                    .map(checkbox => checkbox.nextSibling.textContent);
                                localStorage.setItem('selectedQueries', JSON.stringify(selectedQueries));
                            });
                        });

                        // Add a submit button to the left side
                        const submitButton = document.createElement('button');
                        submitButton.textContent = 'Submit Selected Queries';
                        submitButton.className = 'submit-button';
                        leftSide.appendChild(submitButton);

                        // Add event listener to the submit button
                        submitButton.addEventListener('click', () => {
                            // Open the new page
                            const newWindow = window.open('/selected_queries', '_blank');
                            newWindow.addEventListener('DOMContentLoaded', () => {
                                const ul = newWindow.document.querySelector('ul');
                                const storedQueries = JSON.parse(localStorage.getItem('selectedQueries'));
                                storedQueries.forEach(query => {
                                    const li = newWindow.document.createElement('li');
                                    li.textContent = query;
                                    ul.appendChild(li);
                                });
                            });
                        });
                    })
                    .catch(error => console.error('Error fetching entries:', error));
            </script>

                

        </div>
    </div>

</body>
</html>



